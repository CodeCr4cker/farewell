<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="shortcut icon" href="https://raw.githubusercontent.com/CodeCr4cker/Web-Storage/main/Farewell-invitation-card/images/favicon.jpg" type="image/jpg" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <title>Golden Days of Our Batch</title>
        <meta name="description" content="Ending with Beautiful Beginnings">
         <meta name="description" content="
           This farewell website has been beautifully designed By Divyanshu Pandey to honor 
           and Celebrate the journey of all students of Class 12th As we say goodbye to this 
           wonderful chapter,let's celebrate the moments that made out time together unforgettable!"> 
         <meta name="description" content="">
    
    <meta property="og:image" content="https://raw.githubusercontent.com/CodeCr4cker/Web-Storage/main/Farewell-invitation-card/images/favicon.jpg">
<!--<meta property="og:url" content="https://farewell2025.netlify.app"> -->
<meta property="og:type" content="website">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Dancing+Script:wght@400;600;700&family=Playfair+Display:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --primary-dark: #0a0e27;
            --secondary-dark: #141b2d;
            --accent-gold: #d4af37;
            --accent-purple: #8b5cf6;
            --text-light: #e2e8f0;
            --text-muted: #94a3b8;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--secondary-dark) 100%);
            color: var(--text-light);
            overflow-x: hidden;
            min-height: 100vh;
        }


         .container {
            max-width: 900px;
            margin: 0 auto;
            background: #0a0e27;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #0a0e27 0%, #141b2d 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .stats-bar {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 15px;
            font-size: 0.9em;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .comment-section {
            padding: 30px;
            border-bottom: 2px solid #141b2d;
        }

        .user-info-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #141b2d;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .user-details {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgb(15, 12, 54);
            font-size: 18px;
            font-weight: bold;
        }

        .user-name {
            font-weight: 600;
            color: #333;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-comment {
            background: #667eea;
            color: white;
            width: 100%;
        }

        .btn-comment:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-comment:active {
            transform: translateY(0);
        }

        .btn-logout {
            background: #ff4757;
            color: white;
            padding: 10px 25px;
            font-size: 14px;
        }

        .btn-logout:hover {
            background: #ee3344;
        }

        .btn-submit {
            background: #667eea;
            color: white;
            width: 100%;
            margin-top: 15px;
        }

        .btn-submit:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-submit:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .btn-cancel {
            background: #95a5a6;
            color: white;
            width: 100%;
            margin-top: 10px;
        }

        .btn-cancel:hover {
            background: #7f8c8d;
        }

        .btn-register {
            background: #2ecc71;
            color: white;
            width: 100%;
            margin-top: 10px;
        }

        .btn-register:hover {
            background: #27ae60;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        .modal-overlay.show {
            display: flex;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 15px;
            max-width: 450px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { 
                opacity: 0;
                transform: translateY(50px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-title {
            font-size: 1.8em;
            color: #333;
            margin-bottom: 25px;
            text-align: center;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }

        .form-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .comment-textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #0a0e27;
            border-radius: 10px;
            font-size: 16px;
            font-family: inherit;
            resize: vertical;
            min-height: 120px;
            transition: border-color 0.3s ease;
        }

        .comment-textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .char-counter {
            text-align: right;
            color: #999;
            font-size: 0.9em;
            margin-top: 5px;
        }

        .char-counter.warning {
            color: #ff4757;
        }

        .error-message, .success-message {
            padding: 12px 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 14px;
            display: none;
        }

        .error-message {
            background: #ffe0e0;
            color: #d32f2f;
            border-left: 4px solid #d32f2f;
        }

        .success-message {
            background: #e0ffe0;
            color: #2e7d32;
            border-left: 4px solid #2e7d32;
        }

        .error-message.show, .success-message.show {
            display: block;
        }

        .comments-list {
            padding: 30px;
        }

        .section-title {
            font-size: 1.5em;
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .comment-item {
            background: #141b2d;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #272c41;
            animation: slideIn 0.3s ease;
            position: relative;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .comment-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .comment-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgb(255, 255, 255);
            font-weight: bold;
        }

        input{
            background-color: #141b2d;
        }
        .comment-author {
            font-weight: 600;
            color: #667eea;
        }

        .comment-time {
            color: #999;
            font-size: 0.9em;
            margin-left: auto;
        }

        .comment-text {
            color: #ffffff;
            line-height: 1.6;
            margin-left: 50px;
            word-wrap: break-word;
            margin-bottom: 10px;
        }

        .comment-actions {
            display: flex;
            gap: 15px;
            margin-left: 50px;
            align-items: center;
        }

        .action-btn {
            background: none;
            border: none;
            color: #999;
            cursor: pointer;
            font-size: 0.9em;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: color 0.3s;
        }

        .action-btn:hover {
            color: #667eea;
        }

        .action-btn.liked {
            color: #ff4757;
        }

        .no-comments {
            text-align: center;
            color: #999;
            padding: 40px;
            font-style: italic;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #667eea;
        }

        .hide {
            display: none;
        }

        .tab-switch {
            text-align: center;
            margin-top: 15px;
            color: #667eea;
            cursor: pointer;
            font-size: 0.9em;
        }

        .tab-switch:hover {
            text-decoration: underline;
        }

        @media (max-width: 600px) {
            .user-info-bar {
                flex-direction: column;
                gap: 15px;
            }
        }


        

        /* Book Animation - Updated Colors */
        .book-container {
            width: 100%;
            max-width: 900px;
            margin: 4rem auto;
            padding: 2rem;
            container-type: inline-size;
        }

        .book {
            position: relative;
            display: flex;
            margin: auto;
            width: 60cqmin;
            pointer-events: none;
            transform-style: preserve-3d;
            transition: translate 1s, rotate 1s;
            translate: calc(min(var(--c), 1) * 50%) 0%;
            rotate: 1 0 0 30deg;
        }

        .book.closed {
            rotate: 0 0 0 0deg;
            translate: 0 0;
        }

        .page {
            --thickness: 4;
            flex: none;
            display: flex;
            width: 100%;
            font-size: 2cqmin;
            pointer-events: all;
            user-select: none;
            transform-style: preserve-3d;
            transform-origin: left center;
            transition: transform 1s, rotate 1s ease-in calc((min(var(--i), var(--c)) - max(var(--i), var(--c))) * 50ms);
            translate: calc(var(--i) * -100%) 0px 0px;
            transform: translateZ(calc((var(--c) - var(--i) - 0.5) * calc(var(--thickness) * .23cqmin)));
            rotate: 0 1 0 calc(clamp(0, var(--c) - var(--i), 1) * -180deg);
        }

        .front, .back {
            position: relative;
            flex: none;
            width: 100%;
            height: 56.25cqmin;
            backface-visibility: hidden;
            overflow: hidden;
            background: linear-gradient(135deg, rgba(20, 27, 45, 0.95), rgba(10, 14, 39, 0.95));
            translate: 0px;
            cursor: pointer;
            border: 2px solid rgba(212, 175, 55, 0.3);
        }

        .back {
            translate: -100% 0;
            rotate: 0 1 0 180deg;
        }

        .book {
            counter-reset: page -1;
        }

        .page {
            box-shadow: 0em .5em 2em -.2em rgba(212, 175, 55, 0.3);
        }

        .front, .back {
            display: flex;
            flex-flow: column wrap;
            justify-content: center;
            align-items: center;
        }

        .front::after, .back::after {
            position: absolute;
            bottom: 1em;
            counter-increment: page;
            content: counter(page) ".";
            font-size: 0.8em;
            z-index: 10;
            background: rgba(212, 175, 55, 0.2);
            color: var(--accent-gold);
            padding: 0.2em 0.5em;
            border-radius: 0.3em;
            border: 1px solid rgba(212, 175, 55, 0.4);
        }

        .cover::after {
            content: "";
        }

        .front {
            background: linear-gradient(to left, rgba(20, 27, 45, 0.95) 80%, rgba(10, 14, 39, 1) 100%);
            border-radius: .1em .5em .5em .1em;
        }

        .front::after {
            right: 1em;
        }

        .back {
            background: linear-gradient(to right, rgba(20, 27, 45, 0.95) 80%, rgba(10, 14, 39, 1) 100%);
            border-radius: .5em .1em .1em .5em;
        }

        .back::after {
            left: 1em;
        }

        .cover {
            background: radial-gradient(circle farthest-corner at 80% 20%, rgba(139, 92, 246, 0.4) 0%, rgba(10, 14, 39, 0.9) 100%),
                linear-gradient(135deg, var(--primary-dark), var(--secondary-dark));
            color: var(--accent-gold);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-family: 'Playfair Display', serif;
            font-size: 2em;
            font-weight: bold;
            text-align: center;
            padding: 2em;
            border: 3px solid var(--accent-gold);
        }

        .cover-title {
            font-size: 1.5em;
            margin-bottom: 0.3em;
            text-shadow: 0 0 20px rgba(212, 175, 55, 0.5);
        }

        .cover-subtitle {
            font-size: 0.6em;
            color: var(--text-muted);
            font-family: 'Dancing Script', cursive;
        }

        .video-container {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background: #000;
            position: relative;
        }

        video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        video::-webkit-media-controls-download-button {
            display: none !important;
        }

        .text-content {
            padding: 2em;
            line-height: 1.6;
            text-align: center;
            color: var(--text-light);
        }

        .text-content h2 {
            margin-top: 0;
            color: var(--accent-gold);
            margin-bottom: 1em;
            font-family: 'Playfair Display', serif;
        }

        .text-content p {
            margin: 1em 0;
            color: var(--text-muted);
        }

        .instructions {
            background: rgba(139, 92, 246, 0.15);
            padding: 1.5em;
            border-radius: 0.5em;
            border-left: 4px solid var(--accent-gold);
            margin-top: 1.5em;
            text-align: left;
        }

        .instructions h3 {
            margin-top: 0;
            color: var(--accent-gold);
            font-size: 1.1em;
        }

        .instructions ul {
            margin: 0.5em 0;
            padding-left: 1.5em;
            color: var(--text-light);
        }

        .instructions li {
            margin: 0.5em 0;
        }

        .nav-arrows {
            position: fixed;
            top: 35rem;
            left: 50%;
            transform: translateX(-50%);
            display: none;
            gap: 2rem;
            z-index: 1000;
        }

        .nav-arrows.visible {
            display: flex;
        }

        .arrow-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent-gold), #b8941f);
            border: 2px solid rgba(212, 175, 55, 0.5);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: var(--primary-dark);
            box-shadow: 0 4px 12px rgba(212, 175, 55, 0.4);
            transition: all 0.3s ease;
        }

        .arrow-btn:hover {
            background: linear-gradient(135deg, #ffd700, var(--accent-gold));
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(212, 175, 55, 0.6);
        }

        .arrow-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
            transform: scale(1);
            background: rgba(212, 175, 55, 0.3);
        }

        .arrow-btn:disabled:hover {
            transform: scale(1);
        }

        .play-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background: rgba(0, 0, 0, 0.6);
            cursor: pointer;
            transition: opacity 0.3s;
            z-index: 5;
        }

        .play-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .play-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--accent-gold), #b8941f);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            color: var(--primary-dark);
            box-shadow: 0 4px 12px rgba(212, 175, 55, 0.5);
            transition: all 0.3s;
            pointer-events: none;
        }

        .play-overlay:hover .play-icon {
            transform: scale(1.1);
            background: linear-gradient(135deg, #ffd700, var(--accent-gold));
        }

        /* Video Modal/Fullscreen */
        .video-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.98);
            z-index: 99999;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .video-modal.active {
            display: flex;
        }

        .video-modal-content {
            position: relative;
            width: 90%;
            max-width: 1200px;
            max-height: 90vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .video-modal video {
            width: 100%;
            height: auto;
            max-height: 85vh;
            border-radius: 10px;
            box-shadow: 0 10px 50px rgba(212, 175, 55, 0.3);
        }

        .video-modal-close {
            position: absolute;
            top: -50px;
            right: 0;
            background: linear-gradient(135deg, #ef4444, #dc2626);
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.5);
        }

        .video-modal-close:hover {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            transform: scale(1.1);
        }
    
        /* Loader Styles */
        .loader-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 0.5s;
        }

        .loader {
            text-align: center;
            color: white;
        }

        .loader-animation {
            width: 120px;
            height: 120px;
            position: relative;
            margin: 0 auto 30px;
        }

        .loader-ring {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 3px solid transparent;
            border-top-color: #ffd700;
            animation: rotate 2s linear infinite;
        }

        .loader-ring:nth-child(2) {
            width: 80%;
            height: 80%;
            top: 10%;
            left: 10%;
            border-top-color: #ff6b6b;
            animation-duration: 1.5s;
            animation-direction: reverse;
        }

        .loader-ring:nth-child(3) {
            width: 60%;
            height: 60%;
            top: 20%;
            left: 20%;
            border-top-color: #4ecdc4;
            animation-duration: 1s;
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loader-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
            color: #ffd700;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.1); }
        }

        .loader-text {
            font-size: 22px;
            font-weight: 300;
            letter-spacing: 2px;
            background: linear-gradient(45deg, #ffd700, #ff6b6b, #4ecdc4);
            background-size: 200% 200%;
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: gradient 3s ease infinite;
        }

        @keyframes gradient {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        /* Curtain Styles */
        .curtain-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            z-index: 9999;
            display: none;
            cursor: pointer;
        }

        .curtain-container.visible {
            display: flex;
        }

        .curtain-left, .curtain-right {
            width: 50%;
            height: 100%;
            background: repeating-linear-gradient(to right, #8b0000 0px, #a00000 40px, #6b0000 80px, #8b0000 120px);
            position: relative;
            transition: transform 2s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .curtain-left {
            transform-origin: left;
            box-shadow: 10px 0 30px rgba(0, 0, 0, 0.5);
        }

        .curtain-right {
            transform-origin: right;
            box-shadow: -10px 0 30px rgba(0, 0, 0, 0.5);
        }

        .curtain-container.open .curtain-left {
            transform: translateX(-100%);
        }

        .curtain-container.open .curtain-right {
            transform: translateX(100%);
        }

        .curtain-instruction {
            position: absolute;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            color: var(--accent-gold);
            font-size: 1.2rem;
            animation: bounce 2s ease-in-out infinite;
            z-index: 10;
        }

        @keyframes bounce {
            0%, 100% { transform: translateX(-50%) translateY(0); }
            50% { transform: translateX(-50%) translateY(-10px); }
        }

        /* Navigation */
        .nav-bar {
            position: fixed;
            top: 0;
            width: 100%;
            background: rgba(10, 14, 39, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            z-index: 1000;
            border-bottom: 1px solid rgba(212, 175, 55, 0.2);
            transform: translateY(-100%);
            transition: transform 0.5s ease-out;
        }

        .nav-bar.visible {
            transform: translateY(0);
        }

        .nav-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-logo {
            font-family: 'Playfair Display', serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent-gold);
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            list-style: none;
        }

        .nav-links a {
            color: var(--text-light);
            text-decoration: none;
            transition: color 0.3s;
            font-size: 0.95rem;
        }

        .nav-links a:hover {
            color: var(--accent-gold);
        }

        /* Particles */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: rgba(255, 215, 0, 0.6);
            border-radius: 50%;
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }

        /* Main Content */
        .main-content {
            display: none;
            opacity: 0;
            transition: opacity 1s;
        }

        .main-content.visible {
            display: block;
            opacity: 1;
        }

        /* Hero Section */
        .hero-section {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            padding: 100px 2rem 2rem;
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 1s ease-out, transform 1s ease-out;
        }

        .hero-section.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .hero-content {
            text-align: center;
            max-width: 800px;
        }

        .hero-title {
            font-family: 'Dancing Script', cursive;
            font-size: 5rem;
            font-weight: 700;
            background: linear-gradient(45deg, var(--accent-gold), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1rem;
            animation: titleGlow 3s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% { filter: brightness(1) drop-shadow(0 0 10px rgba(255, 215, 0, 0.3)); }
            50% { filter: brightness(1.3) drop-shadow(0 0 20px rgba(255, 215, 0, 0.6)); }
        }

        .hero-subtitle {
            font-family: 'Dancing Script', cursive;
            font-size: 2rem;
            color: var(--text-muted);
            margin-bottom: 2rem;
        }

        .hero-details {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(212, 175, 55, 0.2);
            border-radius: 20px;
            padding: 2rem;
            margin: 2rem 0;
        }

        .hero-details p {
            margin: 0.5rem 0;
            font-size: 1.1rem;
            color: var(--text-light);
        }

        .highlight {
            color: var(--accent-gold);
            font-weight: 600;
        }

        /* Countdown */
        .countdown-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1.5rem;
            margin: 3rem 0;
        }

        .countdown-item {
            background: rgba(139, 92, 246, 0.1);
            border: 1px solid rgba(139, 92, 246, 0.3);
            border-radius: 15px;
            padding: 2rem 1rem;
            text-align: center;
            transition: all 0.3s ease;
        }

        .countdown-item:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 10px 30px rgba(139, 92, 246, 0.3);
        }

        .countdown-number {
            font-size: 3rem;
            font-weight: 700;
            color: var(--accent-gold);
            display: block;
        }

        .countdown-label {
            color: var(--text-muted);
            text-transform: uppercase;
            font-size: 0.9rem;
            letter-spacing: 1px;
        }

        /* Buttons */
        .btn-primary {
            background: linear-gradient(135deg, var(--accent-gold), #b8941f);
            color: var(--primary-dark);
            padding: 1rem 2rem;
            border: none;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
            margin: 0.5rem;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(212, 175, 55, 0.3);
        }

        .btn-secondary {
            background: rgba(139, 92, 246, 0.2);
            color: var(--text-light);
            border: 2px solid var(--accent-purple);
        }

        /* Gallery Section */
        .gallery-section {
            padding: 5rem 2rem;
            max-width: 1400px;
            margin: 0 auto;
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 1s ease-out, transform 1s ease-out;
        }

        .gallery-section.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .section-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .section-title {
            font-family: 'Playfair Display', serif;
            font-size: 3rem;
            color: var(--accent-gold);
            margin-bottom: 1rem;
        }

        .section-description {
            color: var(--text-muted);
            font-size: 1.1rem;
        }

        /* Gallery Navigation */
        .gallery-nav {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 40px 0;
            flex-wrap: wrap;
        }

        .gallery-nav-btn {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.25), rgba(255, 107, 107, 0.25));
            border: 2px solid rgba(255, 215, 0, 0.4);
            color: #ffd700;
            padding: 15px 35px;
            border-radius: 50px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .gallery-nav-btn:hover, .gallery-nav-btn.active {
            background: linear-gradient(135deg, #746a3b, #ffa500);
            color: #111;
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.5);
        }

        /* Gallery Tabs */
        .gallery-tab {
            display: none;
        }

        .gallery-tab.active {
            display: block;
        }

        /* Old Memories Gallery */
        .memories-gallery {
            display: none;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 40px;
            padding: 40px 20px;
        }

        .memories-gallery.visible {
            display: grid;
        }

        .polaroid-card {
            background: #fff;
            padding: 15px 15px 60px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            transition: all 0.4s;
            cursor: pointer;
            position: relative;
        }

        .polaroid-card:nth-child(odd) {
            transform: rotate(-2deg);
        }

        .polaroid-card:nth-child(even) {
            transform: rotate(2deg);
        }

        .polaroid-card:hover {
            transform: rotate(0deg) scale(1.05) translateY(-10px);
            box-shadow: 0 20px 40px rgba(255, 215, 0, 0.4);
            z-index: 10;
        }

        .polaroid-img {
            width: 100%;
            height: 300px;
            object-fit: cover;
            border: 1px solid #ddd;
        }

        /* Farewell Gallery */
        .farewell-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            padding: 40px 20px;
        }

        .media-card {
            position: relative;
            overflow: hidden;
            border-radius: 20px;
            background: rgba(30, 30, 40, 0.9);
            border: 2px solid rgba(255, 215, 0, 0.3);
            transition: all 0.4s;
            cursor: pointer;
        }

        .media-card:hover {
            transform: scale(1.03);
            border-color: #ffd700;
            box-shadow: 0 15px 40px rgba(255, 215, 0, 0.4);
        }

        .media-content {
            position: relative;
            width: 100%;
            height: 400px;
            overflow: hidden;
        }

        .media-content img, .media-content video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.4s;
        }

        .media-card:hover .media-content img,
        .media-card:hover .media-content video {
            transform: scale(1.1);
        }

        .media-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0, 0, 0, 0.95));
            padding: 20px;
            transform: translateY(100%);
            transition: transform 0.4s;
        }

        .media-card:hover .media-overlay {
            transform: translateY(0);
        }

        .media-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #ffd700;
            margin-bottom: 8px;
        }

        .media-desc {
            font-size: 0.95rem;
            color: #e2e8f0;
            line-height: 1.4;
        }

        /* Gallery Lock */
        .gallery-lock {
            min-height: 60vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.02);
            border: 2px dashed rgba(212, 175, 55, 0.3);
            border-radius: 20px;
            padding: 3rem;
        }

        .gallery-lock.hidden {
            display: none;
        }

        .lock-icon {
            font-size: 4rem;
            color: var(--accent-gold);
            margin-bottom: 2rem;
            animation: lockPulse 2s infinite;
        }

        @keyframes lockPulse {
            0%, 100% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.1) rotate(-5deg); }
            75% { transform: scale(1.1) rotate(5deg); }
        }

        .lock-message {
            font-size: 1.3rem;
            text-align: center;
            margin-bottom: 2rem;
            max-width: 500px;
        }

        /* Close Gallery Button */
        .close-gallery-btn {
            display: none;
            position: fixed;
            top: 90px;
            right: 2rem;
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            z-index: 1001;
            box-shadow: 0 8px 25px rgba(239, 68, 68, 0.4);
            transition: all 0.3s;
        }

        .close-gallery-btn.visible {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .close-gallery-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 35px rgba(239, 68, 68, 0.6);
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 9999;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: linear-gradient(135deg, #1e1e28, #0f0f17);
            border-radius: 20px;
            padding: 2.5rem;
            max-width: 500px;
            width: 100%;
            position: relative;
            border: 1px solid rgba(212, 175, 55, 0.2);
            animation: modalSlideUp 0.3s ease-out;
        }

        @keyframes modalSlideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-title {
            font-family: 'Dancing Script', cursive;
            font-size: 2rem;
            color: var(--accent-gold);
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .modal-input {
            width: 100%;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(212, 175, 55, 0.3);
            border-radius: 10px;
            color: var(--text-light);
            font-size: 1.1rem;
            text-align: center;
            letter-spacing: 5px;
            margin: 1rem 0;
            transition: border-color 0.3s;
        }

        .modal-input:focus {
            outline: none;
            border-color: var(--accent-gold);
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.2);
        }

        .modal-input.text-left {
            letter-spacing: normal;
            text-align: left;
        }

        .error-message {
            color: #ef4444;
            text-align: center;
            margin: 1rem 0;
            display: none;
            animation: shake 0.5s ease-in-out;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 1.5rem;
            cursor: pointer;
            transition: color 0.3s;
        }

        .modal-close:hover {
            color: var(--text-light);
        }

        /* Lightbox */
        .lightbox {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.98);
            z-index: 10000;
            align-items: center;
            justify-content: center;
        }

        .lightbox.active {
            display: flex;
        }

        .lightbox-content {
            max-width: 95%;
            max-height: 95%;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .lightbox-content img,
        .lightbox-content video {
            max-width: 100%;
            max-height: 90vh;
            border-radius: 10px;
        }

        .lightbox-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: rgba(239, 68, 68, 0.9);
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .lightbox-close:hover {
            background: rgba(239, 68, 68, 1);
            transform: scale(1.1);
        }

        /* Success Notification */
        .success-notification {
            position: fixed;
            top: 100px;
            right: 2rem;
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 1rem 2rem;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(16, 185, 129, 0.3);
            z-index: 10001;
            animation: slideInRight 0.5s ease-out, slideOutRight 0.5s ease-out 2.5s;
            pointer-events: none;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 3rem 2rem;
            background: rgba(0, 0, 0, 0.3);
            margin-top: 5rem;
        }

        .footer-text {
            color: var(--text-muted);
            margin: 0.5rem 0;
        }

        .footer-link {
            color: var(--accent-gold);
            text-decoration: none;
            transition: color 0.3s;
        }

        .footer-link:hover {
            color: var(--text-light);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .hero-title {
                font-size: 3rem;
            }

            .hero-subtitle {
                font-size: 1.5rem;
            }

            .countdown-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .nav-links {
                display: none;
            }

            .memories-gallery, .farewell-gallery {
                grid-template-columns: 1fr;
                gap: 30px;
            }

            .gallery-nav {
                flex-direction: column;
                padding: 0 20px;
            }

            .close-gallery-btn {
                top: 80px;
                right: 1rem;
                padding: 0.8rem 1.5rem;
                font-size: 0.9rem;
            }

            .section-title {
                font-size: 2rem;
            }

            .book-container {
                padding: 1rem;
            }

            .book {
                width: 80cqmin;
            }

            .nav-arrows {
                bottom: 1rem;
                gap: 1rem;
            }

            .arrow-btn {
                width: 50px;
                height: 50px;
                font-size: 20px;
            }
        }

        /* Simple styles for search and filter (comments) */
        .comments-controls {
            display: flex;
            gap: 12px;
            align-items: center;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }

        .search-input {
            flex: 1;
            min-width: 220px;
        }

        .filter-bar {
            display: flex;
            gap: 8px;
        }

        .filter-btn {
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid #ddd;
            background: #fff;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .filter-btn.active {
            background: linear-gradient(135deg,#667eea,#764ba2);
            color: #fff;
            border-color: #667eea;
        }
    </style>
</head>
<body>
    <!-- Loader -->
    <div class="loader-container" id="loader">
        <div class="loader">
            <div class="loader-animation">
                <div class="loader-ring"></div>
                <div class="loader-ring"></div>
                <div class="loader-ring"></div>
                <div class="loader-center"><i class="fas fa-heart"></i></div>
            </div>
            <div class="loader-text">Loading Your Memories...</div>
        </div>
    </div>

    <!-- Curtain -->
    <div class="curtain-container" id="curtain">
        <div class="curtain-left"></div>
        <div class="curtain-right"></div>
        <div class="curtain-instruction">
            <i class="fas fa-hand-pointer"></i> Click anywhere to enter
        </div>
    </div>

    <!-- Audio Elements -->
    <audio id="mainAudio" loop preload="auto">
        <source src="https://raw.githubusercontent.com/CodeCr4cker/Web-Storage/main/Farewell-invitation-card/audio/song.mp3" type="audio/mpeg">
    </audio>
    <audio id="galleryAudio" loop preload="auto">
        <source src="https://raw.githubusercontent.com/CodeCr4cker/Web-Storage/main/Farewell-invitation-card/audio/song.mp3" type="audio/mpeg">
    </audio>

    <!-- Close Gallery Button -->
    <button class="close-gallery-btn" id="closeGalleryBtn">
        <i class="fas fa-times"></i> Close Gallery
    </button>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <!-- Particles -->
        <div class="particles" id="particles"></div>

        <!-- Navigation -->
        <nav class="nav-bar" id="navBar">
            <div class="nav-content">
                <div class="nav-logo">Farewell 2025</div>
                <ul class="nav-links">
                    <li><a href="#home">Home</a></li>
                    <li><a href="#videobook">Video Book</a></li>
                    <li><a href="#gallery">Gallery</a></li>
                    <li><a href="#contact">Contact</a></li>
                </ul>
            </div>
        </nav>

        <!-- Hero Section -->
        <section class="hero-section" id="home">
            <div class="hero-content">
                <h1 class="hero-title">Farewell 2025</h1>
                <p class="hero-subtitle">Celebration of Memories</p>
                
                <div class="hero-details">
                    <p>Join us for an unforgettable evening on</p>
                    <p><span class="highlight">14 December 2025</span></p>
                    <p>at <span class="highlight">Dalchini Restaurant</span>, ADA, Naini, Prayagraj</p>
                    <p style="margin-top: 1rem; font-style: italic;">Dinner & Dancing to Follow</p>
                    <p style="margin-top: 1rem; font-style: italic;">Timeing:- 11:30 AM TO 04:30 PM</p>
                    <p style="font-size: 0.95rem; color: var(--text-muted); margin-top: 0.5rem;">
                        Organized by Class 12th, Session 2025-26, BL Academy
                    </p>
                </div>

                <div id="countdownContainer">
                    <div class="countdown-grid" id="countdown"></div>
                </div>

                <div style="margin-top: 2rem;">
                    <button class="btn-primary" onclick="openPersonalInvitationModal()">
                        <i class="fas fa-id-card"></i> Personal Invitation
                    </button>
                    <a href="https://raw.githubusercontent.com/CodeCr4cker/Farewell-invitation-card/main/assets/Invitation/farewell%20.pdf" class="btn-primary" download>
                        <i class="fas fa-download"></i> Download Invitation
                    </a>
                    <a href="https://goo.gl/maps/5z5xX2hTYzU8VGEJ9" target="_blank" class="btn-primary btn-secondary">
                        <i class="fas fa-map-marker-alt"></i> View Venue
                    </a>
                </div>
            </div>
        </section>

        <!-- Video Book Section -->
        <section id="videobook" class="book-container">
            <div class="book">
                <!-- Page 0 - Front Cover -->
                <div class="page">
                    <div class="front cover">
                        <div class="cover-title"> My Video Book</div>
                        <div class="cover-subtitle">A Journey Through Memories</div>
                    </div>
                    <div class="back">
                        <div class="text-content">
                            <h2> Welcome </h2>
                        </div>
                    </div>
                </div>

                <!-- Pages 1-10 with Videos -->
                <div class="page">
                    <div class="front">
                        <div class="video-container">
                            <video controlslist="nodownload" disablepictureinpicture>
                                <source src="https://raw.githubusercontent.com/CodeCr4cker/Web-Storage/main/Farewell-invitation-card/video/B%20L%20Academy(1).mp4" type="video/mp4">
                            </video>
                            <div class="play-overlay">
                                <div class="play-icon"></div>
                            </div>
                        </div>
                    </div>
                    <div class="back">
                        <div class="video-container">
                            <video controlslist="nodownload" disablepictureinpicture>
                                <source src="https://raw.githubusercontent.com/CodeCr4cker/Web-Storage/main/Farewell-invitation-card/video/B%20L%20Academy(2).mp4" type="video/mp4">
                            </video>
                            <div class="play-overlay">
                                <div class="play-icon"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="page">
                    <div class="front">
                        <div class="video-container">
                            <video controlslist="nodownload" disablepictureinpicture>
                                <source src="https://raw.githubusercontent.com/CodeCr4cker/Web-Storage/main/Farewell-invitation-card/video/B%20L%20Academy(3).mp4" type="video/mp4">
                            </video>
                            <div class="play-overlay">
                                <div class="play-icon"></div>
                            </div>
                        </div>
                    </div>
                    <div class="back">
                        <div class="video-container">
                            <video controlslist="nodownload" disablepictureinpicture>
                                <source src="https://raw.githubusercontent.com/CodeCr4cker/Web-Storage/main/Farewell-invitation-card/video/B%20L%20Academy(4).mp4" type="video/mp4">
                            </video>
                            <div class="play-overlay">
                                <div class="play-icon"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="page">
                    <div class="front">
                        <div class="video-container">
                            <video controlslist="nodownload" disablepictureinpicture>
                                <source src="https://raw.githubusercontent.com/CodeCr4cker/Web-Storage/main/Farewell-invitation-card/video/B%20L%20Academy(5).mp4" type="video/mp4">
                            </video>
                            <div class="play-overlay">
                                <div class="play-icon"></div>
                            </div>
                        </div>
                    </div>
                    <div class="back">
                        <div class="video-container">
                            <video controlslist="nodownload" disablepictureinpicture>
                                <source src="https://raw.githubusercontent.com/CodeCr4cker/Web-Storage/main/Farewell-invitation-card/video/B%20L%20Academy(6).mp4" type="video/mp4">
                            </video>
                            <div class="play-overlay">
                                <div class="play-icon"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="page">
                    <div class="front">
                        <div class="video-container">
                            <video controlslist="nodownload" disablepictureinpicture>
                                <source src="https://raw.githubusercontent.com/CodeCr4cker/Web-Storage/main/Farewell-invitation-card/video/B%20L%20Academy(7).mp4" type="video/mp4">
                            </video>
                            <div class="play-overlay">
                                <div class="play-icon"></div>
                            </div>
                        </div>
                    </div>
                    <div class="back">
                        <div class="video-container">
                            <video controlslist="nodownload" disablepictureinpicture>
                                <source src="https://raw.githubusercontent.com/CodeCr4cker/Web-Storage/main/Farewell-invitation-card/video/B%20L%20Academy(8).mp4" type="video/mp4">
                            </video>
                            <div class="play-overlay">
                                <div class="play-icon"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="page">
                    <div class="front">
                        <div class="video-container">
                            <video controlslist="nodownload" disablepictureinpicture>
                                <source src="https://raw.githubusercontent.com/CodeCr4cker/Web-Storage/main/Farewell-invitation-card/video/B%20L%20Academy(9).mp4" type="video/mp4">
                            </video>
                            <div class="play-overlay">
                                <div class="play-icon"></div>
                            </div>
                        </div>
                    </div>
                    <div class="back">
                        <div class="video-container">
                            <video controlslist="nodownload" disablepictureinpicture>
                                <source src="https://raw.githubusercontent.com/CodeCr4cker/Web-Storage/main/Farewell-invitation-card/video/B%20L%20Academy(10).mp4" type="video/mp4">
                            </video>
                            <div class="play-overlay">
                                <div class="play-icon"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="page">
                    <div class="front">
                        <div class="video-container">
                            <video controlslist="nodownload" disablepictureinpicture>
                                <source src="https://raw.githubusercontent.com/CodeCr4cker/Web-Storage/main/Farewell-invitation-card/video/B%20L%20Academy(11).mp4" type="video/mp4">
                            </video>
                            <div class="play-overlay">
                                <div class="play-icon"></div>
                            </div>
                        </div>
                    </div>
                    <div class="back">
                        <div class="video-container">
                            <video controlslist="nodownload" disablepictureinpicture>
                                <source src="https://raw.githubusercontent.com/CodeCr4cker/Web-Storage/main/Farewell-invitation-card/video/B%20L%20Academy(12).mp4" type="video/mp4">
                            </video>
                            <div class="play-overlay">
                                <div class="play-icon"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="page">
                    <div class="front">
                        <div class="video-container">
                            <video controlslist="nodownload" disablepictureinpicture>
                                <source src="https://raw.githubusercontent.com/CodeCr4cker/Web-Storage/main/Farewell-invitation-card/video/B%20L%20Academy(13).mp4" type="video/mp4">
                            </video>
                            <div class="play-overlay">
                                <div class="play-icon"></div>
                            </div>
                        </div>
                    </div>
                    <div class="back">
                        <div class="video-container">
                            <video controlslist="nodownload" disablepictureinpicture>
                                <source src="https://raw.githubusercontent.com/CodeCr4cker/Web-Storage/main/Farewell-invitation-card/video/B%20L%20Academy(14).mp4" type="video/mp4">
                            </video>
                            <div class="play-overlay">
                                <div class="play-icon"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="page">
                    <div class="front">
                        <div class="video-container">
                            <video controlslist="nodownload" disablepictureinpicture>
                                <source src="https://raw.githubusercontent.com/CodeCr4cker/Web-Storage/main/Farewell-invitation-card/video/B%20L%20Academy(15).mp4" type="video/mp4">
                            </video>
                            <div class="play-overlay">
                                <div class="play-icon"></div>
                            </div>
                        </div>
                    </div>
                    <div class="back">
                        <div class="video-container">
                            <video controlslist="nodownload" disablepictureinpicture>
                                <source src="https://raw.githubusercontent.com/CodeCr4cker/Web-Storage/main/Farewell-invitation-card/video/B%20L%20Academy(16).mp4" type="video/mp4">
                            </video>
                            <div class="play-overlay">
                                <div class="play-icon"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="page">
                    <div class="front">
                        <div class="video-container">
                            <video controlslist="nodownload" disablepictureinpicture>
                                <source src="https://raw.githubusercontent.com/CodeCr4cker/Web-Storage/main/Farewell-invitation-card/video/B%20L%20Academy(17).mp4" type="video/mp4">
                            </video>
                            <div class="play-overlay">
                                <div class="play-icon"></div>
                            </div>
                        </div>
                    </div>
                    <div class="back cover">
                        <div class="cover-title"> The End</div>
                        <div class="cover-subtitle">Thank You for Watching</div>
                    </div>
                </div>
                 
            </div>  <div class="nav-arrows">
                <button class="arrow-btn" id="prevBtn" disabled></button>
                <button class="arrow-btn" id="nextBtn"></button>
            </div>

         
        </section>

        <!-- Gallery Section -->
        <section class="gallery-section" id="gallery">
            <div class="section-header">
                <h2 class="section-title">Memory Gallery</h2>
                <p class="section-description">
                    A collection of our precious moments together
                </p>
            </div>

            <!-- Gallery Navigation -->
            <div class="gallery-nav">
                <button class="gallery-nav-btn active" data-tab="memories" onclick="switchGalleryTab('memories', event)">
                    <i class="fas fa-images"></i> Old Memories
                </button>
                <button class="gallery-nav-btn" data-tab="farewell" onclick="switchGalleryTab('farewell', event)">
                    <i class="fas fa-video"></i> Exclusive photos
                </button>
            </div>

            <!-- Old Memories Tab -->
            <div class="gallery-tab active" id="memoriesTab">
                <div class="gallery-lock" id="memoriesLock">
                    <div class="lock-icon">
                        <i class="fas fa-images"></i>
                    </div>
                    <button class="btn-primary" onclick="openMemoriesGallery()">
                        <i class="fas fa-folder-open"></i> Open Album
                    </button>
                </div>
                <div class="memories-gallery" id="memoriesGrid"></div>
            </div>

            <!-- Farewell Gallery Tab -->
            <div class="gallery-tab" id="farewellTab">
                <div class="gallery-lock" id="galleryLock">
                    <div class="lock-icon">
                        <i class="fas fa-lock"></i>
                    </div>
                    <button class="btn-primary" onclick="openGalleryModal()">
                        <i class="fas fa-key"></i> Enter Access Code
                    </button>
                </div>
                <div class="farewell-gallery" id="farewellGrid" style="display: none;"></div>
            </div>
        </section>





         <div class="container">
        <div class="header">
            <h1> Rospesnse Box</h1>
            <p>Share your thoughts with the community</p>
            <div class="stats-bar">
                <div class="stat-item">
                    <span></span>
                    <span id="totalComments">0</span>
                    <span>Comments</span>
                </div>
                <div class="stat-item">
                    <span></span>
                    <span id="totalUsers">0</span>
                    <span>Contributors</span>
                </div>
            </div>
        </div>

        <div class="comment-section">
            <div id="userInfoSection" class="hide">
                <div class="user-info-bar">
                    <div class="user-details">
                        <div class="user-avatar" id="userAvatar"></div>
                        <span class="user-name" id="userName"></span>
                    </div>
                    <button class="btn btn-logout" id="logoutBtn">Logout</button>
                </div>
            </div>
            <button class="btn btn-comment" id="commentBtn"> Add your Response</button>
        </div>

        <div class="comments-list">
            <div class="section-title">
                <span>All Thought</span>
                <span id="commentsInfo" style="font-size:1rem;color:#666;"></span>
            </div>

            <!-- Search and Filter controls (added to avoid JS errors and to provide UI) -->
            <div class="comments-controls" style="padding: 0 30px; margin-top: 12px;">
                <input id="searchInput" class="form-input search-input" placeholder="Search comments by text or author...">
                <div id="filterBar" class="filter-bar" role="tablist" aria-label="Filter comments">
                    <button class="filter-btn active" data-filter="newest">Newest</button>
                    <button class="filter-btn" data-filter="oldest">Oldest</button>
                    <button class="filter-btn" data-filter="popular">Popular</button>
                </div>
            </div>

            <div id="commentsList" style="padding: 0 30px;">
                <div class="loading">Loading comments...</div>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="modal-overlay">
        <div class="modal-content">
            <h2 class="modal-title"> Login to Comment</h2>
            <div class="form-group">
                <label for="emailInput">Email</label>
                <input type="email" id="emailInput" class="form-input" placeholder="Enter your email">
            </div>
            <div class="form-group">
                <label for="passwordInput">Password</label>
                <input type="password" id="passwordInput" class="form-input" placeholder="Enter your password">
            </div>
            <button class="btn btn-submit" id="loginBtn">Login</button>
            <button class="btn btn-register" id="showRegisterBtn">Create New Account</button>
            <button class="btn btn-cancel" id="cancelLoginBtn">Cancel</button>
            <div id="loginError" class="error-message"></div>
        </div>
    </div>

    <!-- Register Modal -->
    <div id="registerModal" class="modal-overlay">
        <div class="modal-content">
            <h2 class="modal-title"> Create Account</h2>
            <div class="form-group">
                <label for="regEmailInput">Email</label>
                <input type="email" id="regEmailInput" class="form-input" placeholder="Enter your email">
            </div>
            <div class="form-group">
                <label for="regPasswordInput">Password</label>
                <input type="password" id="regPasswordInput" class="form-input" placeholder="Minimum 6 characters">
            </div>
            <div class="form-group">
                <label for="regConfirmPasswordInput">Confirm Password</label>
                <input type="password" id="regConfirmPasswordInput" class="form-input" placeholder="Re-enter password">
            </div>
            <button class="btn btn-submit" id="registerBtn">Create Account</button>
            <button class="btn btn-cancel" id="cancelRegisterBtn">Cancel</button>
            <div id="registerError" class="error-message"></div>
            <div id="registerSuccess" class="success-message"></div>
            <div class="tab-switch" id="backToLoginBtn">Already have an account? Login</div>
        </div>
    </div>

    <!-- Comment Modal -->
    <div id="commentModal" class="modal-overlay">
        <div class="modal-content">
            <h2 class="modal-title"> Write Your Thought</h2>
            <textarea 
                class="comment-textarea" 
                id="commentInput" 
                placeholder="Share your thoughts..."
                maxlength="500"
            ></textarea>
            <div class="char-counter" id="charCounter">0 / 500</div>
            <button class="btn btn-submit" id="submitCommentBtn">Post Comment</button>
            <button class="btn btn-cancel" id="cancelCommentBtn">Cancel</button>
            <div id="commentError" class="error-message"></div>
        </div>
    </div>


        <!-- Footer -->
        <footer class="footer" id="contact">
            <p class="footer-text">
                Can't wait to make this farewell memorable with you!
            </p>
            <p class="footer-text">
                Just a ping away for any queries: 
                <a href="https://its-divyanshu.netlify.app/" class="footer-link">Contact Me</a>
            </p>
            <p class="footer-text" style="margin-top: 1.5rem;">
                Join us in our happiness! 
            </p>
            <p class="footer-text" style="margin-top: 1rem;">
                 Divyanshu Pandey
            </p>
        </footer>
    </div>

    <!-- Gallery Access Modal -->
    <div class="modal" id="galleryModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeGalleryModal()">
                <i class="fas fa-times"></i>
            </button>
            <h2 class="modal-title"> Gallery Access</h2>
            <p style="text-align: center; color: var(--text-muted); margin-bottom: 1.5rem;">
                Enter the 6-character access code
            </p>
            <input 
                type="text" 
                class="modal-input" 
                id="galleryCode" 
                placeholder="------"
                maxlength="6"
            >
            <div class="error-message" id="galleryError">
                Invalid access code. Please try again.
            </div>
            <button class="btn-primary" style="width: 100%; margin-top: 1rem;" onclick="verifyGalleryCode()">
                <i class="fas fa-unlock"></i> Unlock Gallery
            </button>
        </div>
    </div>

    <!-- Personal Invitation Modal -->
    <div class="modal" id="personalInvitationModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closePersonalInvitationModal()">
                <i class="fas fa-times"></i>
            </button>
            <h2 class="modal-title">Personal Invitation</h2>
            <p style="text-align: center; color: var(--text-muted); margin-bottom: 1.5rem;">
                Enter your credentials to generate invitation
            </p>
            <input 
                type="text" 
                class="modal-input text-left" 
                id="username" 
                placeholder="Username"
            >
            <input 
                type="password" 
                class="modal-input text-left" 
                id="password" 
                placeholder="Password"
            >
            <div class="error-message" id="invitationError">
                Invalid credentials. Please try again.
            </div>
            <button class="btn-primary" style="width: 100%; margin-top: 1rem;" onclick="generatePersonalInvitation()">
                <i class="fas fa-download"></i> Generate & Download
            </button>
        </div>
    </div>

    <!-- Lightbox -->
    <div class="lightbox" id="lightbox">
        <div class="lightbox-content">
            <button class="lightbox-close" onclick="closeLightbox()">
                <i class="fas fa-times"></i>
            </button>
            <div id="lightboxMedia"></div>
        </div>
    </div>

    <!-- Video Modal for Book Videos -->
    <div class="video-modal" id="videoModal">
        <div class="video-modal-content">
            <button class="video-modal-close" onclick="closeVideoModal()">
                <i class="fas fa-times"></i>
            </button>
            <video id="modalVideo" controls controlslist="nodownload" disablepictureinpicture></video>
        </div>
    </div>

     <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script>
       // Firebase configuration
        const firebaseConfig = {
  apiKey: "AIzaSyDr_reHnwMBlZ8HnhT-Ae9Rl4wwvOG2nuk",
  authDomain: "chat-67712.firebaseapp.com",
  databaseURL: "https://chat-67712-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "chat-67712",
  storageBucket: "chat-67712.firebasestorage.app",
  messagingSenderId: "666294677963",
  appId: "1:666294677963:web:42b547e2dd362e7847464e",
  measurementId: "G-SV83LJ44YJ"
};

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();

        // DOM elements
        const commentBtn = document.getElementById('commentBtn');
        const loginModal = document.getElementById('loginModal');
        const registerModal = document.getElementById('registerModal');
        const commentModal = document.getElementById('commentModal');
        const emailInput = document.getElementById('emailInput');
        const passwordInput = document.getElementById('passwordInput');
        const loginBtn = document.getElementById('loginBtn');
        const cancelLoginBtn = document.getElementById('cancelLoginBtn');
        const showRegisterBtn = document.getElementById('showRegisterBtn');
        const backToLoginBtn = document.getElementById('backToLoginBtn');
        const loginError = document.getElementById('loginError');
        
        const regEmailInput = document.getElementById('regEmailInput');
        const regPasswordInput = document.getElementById('regPasswordInput');
        const regConfirmPasswordInput = document.getElementById('regConfirmPasswordInput');
        const registerBtn = document.getElementById('registerBtn');
        const cancelRegisterBtn = document.getElementById('cancelRegisterBtn');
        const registerError = document.getElementById('registerError');
        const registerSuccess = document.getElementById('registerSuccess');
        
        const commentInput = document.getElementById('commentInput');
        const charCounter = document.getElementById('charCounter');
        const submitCommentBtn = document.getElementById('submitCommentBtn');
        const cancelCommentBtn = document.getElementById('cancelCommentBtn');
        const commentError = document.getElementById('commentError');
        const commentsList = document.getElementById('commentsList');
        const userInfoSection = document.getElementById('userInfoSection');
        const userAvatar = document.getElementById('userAvatar');
        const userName = document.getElementById('userName');
        const logoutBtn = document.getElementById('logoutBtn');
        const totalComments = document.getElementById('totalComments');
        const totalUsers = document.getElementById('totalUsers');
        const commentsInfo = document.getElementById('commentsInfo');

        // New: optional search and filter elements (may be null in other copies)
        const searchInput = document.getElementById('searchInput');
        const filterBar = document.getElementById('filterBar');

        let currentUser = null;
        let allComments = [];
        let currentFilter = 'newest';
        let currentSearchTerm = '';
        let editingCommentId = null;

        // Helpers: show/hide errors and success
        function showError(el, message) {
            if (!el) return;
            el.textContent = message;
            el.classList.add('show');
        }

        function showSuccess(el, message) {
            if (!el) return;
            el.textContent = message;
            el.classList.add('show');
        }

        function hideError(el) {
            if (!el) return;
            el.textContent = '';
            el.classList.remove('show');
        }

        // Auth state observer - keeps UI in sync
        auth.onAuthStateChanged((user) => {
            if (user) {
                currentUser = user;
                showUserInfo(user);
            } else {
                currentUser = null;
                hideUserInfo();
            }
        });

        // Show user info in UI
        function showUserInfo(user) {
            if (!user) return;
            userInfoSection.classList.remove('hide');
            const username = user.displayName || (user.email ? user.email.split('@')[0] : 'User');
            const initial = username.charAt(0).toUpperCase();
            userAvatar.textContent = initial;
            userName.textContent = username;
        }

        function hideUserInfo() {
            userInfoSection.classList.add('hide');
            userAvatar.textContent = '';
            userName.textContent = '';
        }

        // Comment button click
        commentBtn.onclick = function() {
            if (auth.currentUser) {
                openCommentModal();
            } else {
                openLoginModal();
            }
        };

        // Modal functions
        function openLoginModal() {
            loginModal.classList.add('show');
            emailInput.value = '';
            passwordInput.value = '';
            hideError(loginError);
        }

        function closeLoginModal() {
            loginModal.classList.remove('show');
        }

        function openRegisterModal() {
            registerModal.classList.add('show');
            regEmailInput.value = '';
            regPasswordInput.value = '';
            regConfirmPasswordInput.value = '';
            hideError(registerError);
            hideError(registerSuccess);
        }

        function closeRegisterModal() {
            registerModal.classList.remove('show');
        }

        function openCommentModal(commentId = null, commentText = '') {
            commentModal.classList.add('show');
            commentInput.value = commentText;
            editingCommentId = commentId;
            updateCharCounter();
            hideError(commentError);
            commentInput.focus();
            
            const modalTitle = commentModal.querySelector('.modal-title');
            const submitBtn = document.getElementById('submitCommentBtn');
            if (commentId) {
                modalTitle.textContent = ' Edit Your Comment';
                submitBtn.textContent = 'Update Comment';
            } else {
                modalTitle.textContent = ' Write Your Comment';
                submitBtn.textContent = 'Post Comment';
            }
        }

        function closeCommentModal() {
            commentModal.classList.remove('show');
            editingCommentId = null;
            commentInput.value = '';
            updateCharCounter();
        }

        // Switch between login and register
        showRegisterBtn.onclick = function() {
            closeLoginModal();
            openRegisterModal();
        };

        backToLoginBtn.onclick = function() {
            closeRegisterModal();
            openLoginModal();
        };

        // Cancel buttons
        cancelLoginBtn.onclick = closeLoginModal;
        cancelRegisterBtn.onclick = closeRegisterModal;
        cancelCommentBtn.onclick = closeCommentModal;

        // Close modals on overlay click
        loginModal.onclick = function(e) {
            if (e.target === loginModal) closeLoginModal();
        };
        registerModal.onclick = function(e) {
            if (e.target === registerModal) closeRegisterModal();
        };
        commentModal.onclick = function(e) {
            if (e.target === commentModal) closeCommentModal();
        };

        // Character counter
        commentInput.oninput = updateCharCounter;

        function updateCharCounter() {
            const length = (commentInput.value || '').length;
            charCounter.textContent = `${length} / 500`;
            if (length > 450) {
                charCounter.classList.add('warning');
            } else {
                charCounter.classList.remove('warning');
            }
        }

        // Register function (immediately set currentUser from returned userCredential)
        registerBtn.onclick = async function() {
            const email = regEmailInput.value.trim();
            const password = regPasswordInput.value;
            const confirmPassword = regConfirmPasswordInput.value;

            hideError(registerError);
            hideError(registerSuccess);

            if (!email || !password || !confirmPassword) {
                showError(registerError, 'Please fill in all fields');
                return;
            }

            if (password.length < 6) {
                showError(registerError, 'Password must be at least 6 characters');
                return;
            }

            if (password !== confirmPassword) {
                showError(registerError, 'Passwords do not match');
                return;
            }

            registerBtn.disabled = true;
            registerBtn.textContent = 'Creating Account...';

            try {
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                const user = userCredential.user;
                currentUser = user;
                showUserInfo(user);

                showSuccess(registerSuccess, 'Account created successfully! Logging you in...');
                setTimeout(() => {
                    closeRegisterModal();
                    openCommentModal();
                }, 800);
            } catch (error) {
                let errorMsg = 'Registration failed. ';
                if (error.code === 'auth/email-already-in-use') {
                    errorMsg += 'This email is already registered.';
                } else if (error.code === 'auth/invalid-email') {
                    errorMsg += 'Invalid email address.';
                } else if (error.code === 'auth/weak-password') {
                    errorMsg += 'Password is too weak.';
                } else {
                    errorMsg += error.message;
                }
                showError(registerError, errorMsg);
            } finally {
                registerBtn.disabled = false;
                registerBtn.textContent = 'Create Account';
            }
        };

        // Login function (set currentUser immediately)
        loginBtn.onclick = async function() {
            const email = emailInput.value.trim();
            const password = passwordInput.value;

            if (!email || !password) {
                showError(loginError, 'Please enter both email and password');
                return;
            }

            loginBtn.disabled = true;
            loginBtn.textContent = 'Logging in...';

            try {
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                const user = userCredential.user;
                currentUser = user;
                showUserInfo(user);

                closeLoginModal();
                openCommentModal();
            } catch (error) {
                let errorMsg = 'Login failed. ';
                if (error.code === 'auth/user-not-found') {
                    errorMsg += 'User not found.';
                } else if (error.code === 'auth/wrong-password') {
                    errorMsg += 'Incorrect password.';
                } else if (error.code === 'auth/invalid-email') {
                    errorMsg += 'Invalid email address.';
                } else if (error.code === 'auth/invalid-credential') {
                    errorMsg += 'Invalid credentials.';
                } else {
                    errorMsg += error.message;
                }
                showError(loginError, errorMsg);
            } finally {
                loginBtn.disabled = false;
                loginBtn.textContent = 'Login';
            }
        };

        // Allow Enter key for login/register
        passwordInput.onkeypress = function(e) {
            if (e.key === 'Enter') loginBtn.click();
        };

        regConfirmPasswordInput.onkeypress = function(e) {
            if (e.key === 'Enter') registerBtn.click();
        };

        // Submit/Update comment (use auth.currentUser fallback)
        submitCommentBtn.onclick = async function() {
            const commentText = (commentInput.value || '').trim();
            
            if (!commentText) {
                showError(commentError, 'Please write a comment');
                return;
            }

            const user = auth.currentUser || currentUser;
            if (!user) {
                showError(commentError, 'Please login to comment');
                return;
            }

            submitCommentBtn.disabled = true;
            submitCommentBtn.textContent = editingCommentId ? 'Updating...' : 'Posting...';

            try {
                const username = user.displayName || (user.email ? user.email.split('@')[0] : 'User');
                
                if (editingCommentId) {
                    // Update existing comment (only allow if owner)
                    const snapshot = await database.ref(`comments/${editingCommentId}/authorId`).once('value');
                    if (snapshot.exists() && snapshot.val() === user.uid) {
                        await database.ref(`comments/${editingCommentId}`).update({
                            text: commentText,
                            edited: true,
                            editedAt: firebase.database.ServerValue.TIMESTAMP
                        });
                    } else {
                        showError(commentError, 'You are not allowed to edit this comment.');
                    }
                } else {
                    // Create new comment
                    await database.ref('comments').push({
                        text: commentText,
                        author: username,
                        authorId: user.uid,
                        timestamp: firebase.database.ServerValue.TIMESTAMP,
                        likes: 0,
                        likedBy: {}
                    });
                }

                closeCommentModal();
            } catch (error) {
                console.error('Failed to post comment', error);
                showError(commentError, 'Failed to post comment: ' + (error.message || error));
            } finally {
                submitCommentBtn.disabled = false;
                submitCommentBtn.textContent = editingCommentId ? 'Update Comment' : 'Post Comment';
            }
        };

        // Delete comment (only owner can delete)
        window.deleteComment = async function(commentId) {
            if (!confirm('Are you sure you want to delete this comment?')) return;
            
            const user = auth.currentUser || currentUser;
            if (!user) {
                openLoginModal();
                return;
            }

            try {
                const snapshot = await database.ref(`comments/${commentId}`).once('value');
                const comment = snapshot.val();
                if (!comment) {
                    alert('Comment not found.');
                    return;
                }
                if (comment.authorId !== user.uid) {
                    alert('You are not allowed to delete this comment.');
                    return;
                }

                await database.ref(`comments/${commentId}`).remove();
            } catch (error) {
                alert('Failed to delete comment: ' + error.message);
            }
        };

        // Edit comment - open modal pre-filled (only owner can edit)
        window.editComment = async function(commentId, commentText) {
            const user = auth.currentUser || currentUser;
            if (!user) {
                openLoginModal();
                return;
            }

            try {
                const snapshot = await database.ref(`comments/${commentId}/authorId`).once('value');
                if (snapshot.exists() && snapshot.val() === user.uid) {
                    openCommentModal(commentId, commentText);
                } else {
                    alert('You are not allowed to edit this comment.');
                }
            } catch (error) {
                console.error('Edit check failed', error);
                alert('Could not verify permission to edit: ' + error.message);
            }
        };

        // Like/Unlike comment
        window.toggleLike = async function(commentId) {
            const user = auth.currentUser || currentUser;
            if (!user) {
                openLoginModal();
                return;
            }

            const likeRef = database.ref(`comments/${commentId}/likedBy/${user.uid}`);
            try {
                const snapshot = await likeRef.once('value');
                
                if (snapshot.exists()) {
                    // Unlike
                    await likeRef.remove();
                    await database.ref(`comments/${commentId}/likes`).transaction((likes) => {
                        return (likes || 1) - 1;
                    });
                } else {
                    // Like
                    await likeRef.set(true);
                    await database.ref(`comments/${commentId}/likes`).transaction((likes) => {
                        return (likes || 0) + 1;
                    });
                }
            } catch (error) {
                console.error('Like toggle failed', error);
                alert('Failed to toggle like: ' + error.message);
            }
        };

        // Logout
        logoutBtn.onclick = function() {
            auth.signOut().catch((error) => {
                alert('Logout failed: ' + error.message);
            });
        };

        // Real-time listener for comments
        database.ref('comments').on('value', (snapshot) => {
            const comments = [];
            snapshot.forEach(child => {
                comments.push({ id: child.key, ...child.val() });
            });

            allComments = comments;
            totalComments.textContent = comments.length;
            const userIds = new Set(comments.map(c => c.authorId).filter(Boolean));
            totalUsers.textContent = userIds.size;

            // Extra info
            commentsInfo.textContent = `${comments.length} total  ${userIds.size} contributors`;

            renderComments();
        }, (error) => {
            console.error('Failed to read comments:', error);
            commentsList.innerHTML = `<div class="error-message show">Failed to load comments: ${escapeHtml(error.message || error)}</div>`;
        });

        // Search/filter handling (guard for null)
        if (searchInput) {
            searchInput.addEventListener('input', (e) => {
                currentSearchTerm = e.target.value.trim().toLowerCase();
                renderComments();
            });
        }

        // Filter buttons handling (guard for null)
        if (filterBar) {
            filterBar.addEventListener('click', (e) => {
                const btn = e.target.closest('.filter-btn');
                if (!btn) return;
                [...filterBar.querySelectorAll('.filter-btn')].forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentFilter = btn.dataset.filter || 'newest';
                renderComments();
            });
        }

        // Helper: escape HTML
        function escapeHtml(str) {
            if (str === undefined || str === null) return '';
            return String(str)
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#039;');
        }

        // Render comments into DOM
        function renderComments() {
            try {
                let items = (allComments || []).slice();

                // Search filter
                if (currentSearchTerm) {
                    items = items.filter(c => {
                        const text = (c.text || '').toLowerCase();
                        const author = (c.author || '').toLowerCase();
                        return text.includes(currentSearchTerm) || author.includes(currentSearchTerm);
                    });
                }

                // Sorting
                if (currentFilter === 'newest') {
                    items.sort((a,b) => (b.timestamp || 0) - (a.timestamp || 0));
                } else if (currentFilter === 'oldest') {
                    items.sort((a,b) => (a.timestamp || 0) - (b.timestamp || 0));
                } else if (currentFilter === 'popular') {
                    items.sort((a,b) => (b.likes || 0) - (a.likes || 0));
                }

                if (items.length === 0) {
                    commentsList.innerHTML = '<div class="no-comments">No comments yet.</div>';
                    return;
                }

                const user = auth.currentUser || currentUser;

                commentsList.innerHTML = items.map(c => {
                    const time = c.timestamp ? new Date(c.timestamp).toLocaleString() : '';
                    const author = c.author || (c.authorId ? 'User' : 'Anonymous');
                    const safeText = escapeHtml(c.text || '');
                    const avatarLetter = escapeHtml((author && author.charAt(0).toUpperCase()) || 'U');
                    const isMine = user ? (c.authorId === user.uid) : false;
                    const likeCount = c.likes || 0;

                    // Determine if current user liked this comment (best-effort: check likedBy map)
                    let likedClass = '';
                    let likedAttr = '';
                    if (user && c.likedBy && c.likedBy[user.uid]) {
                        likedClass = 'liked';
                        likedAttr = ' (You)';
                    }

                    // Sanitize for attributes - avoid backticks in template by using split/join for text in onclick arg
                    const safeTextForEdit = (c.text || '').replace(/`/g, '\\`').replace(/\\/g, '\\\\').replace(/\$/g, '\\$');

                    return `
                        <div class="comment-item" id="comment-${escapeHtml(c.id)}">
                            <div class="comment-header">
                                <div class="comment-avatar">${avatarLetter}</div>
                                <div class="comment-author">${escapeHtml(author)}</div>
                                <div class="comment-time">${escapeHtml(time)}</div>
                            </div>
                            <div class="comment-text">${safeText}</div>
                            <div class="comment-actions">
                                <button class="action-btn ${likedClass}" onclick="toggleLike('${escapeHtml(c.id)}')"> ${likeCount}${likedAttr}</button>
                                ${isMine ? `<button class="action-btn" onclick="editComment('${escapeHtml(c.id)}', \`${escapeHtml(safeTextForEdit)}\`)">Edit</button>
                                <button class="action-btn" onclick="deleteComment('${escapeHtml(c.id)}')">Delete</button>` : ''}
                            </div>
                        </div>
                    `;
                }).join('');
            } catch (err) {
                console.error('Render failed', err);
                commentsList.innerHTML = `<div class="error-message show">Failed to render comments: ${escapeHtml(err.message || err)}</div>`;
            }
        }

        // Initial render (in case no comments yet)
        renderComments();




        
        // ========== CONFIGURATION SECTION ==========
        
        const GALLERY_CODE = '12BL25';
        const PUBLIC_INVITATION_PDF = 'https://raw.githubusercontent.com/CodeCr4cker/Farewell-invitation-card/main/assets/Invitation/farewell%20.pdf';
        
        // User Database for Personal Invitations
        const userDatabase = {
            'divyanshu': { 
                password: 'div123', 
                name: 'Divyanshu Pandey',
                pdfUrl: 'https://your-domain.com/invitations/divyanshu-invitation.pdf'
            },
            'rahul': { 
                password: 'rahul456', 
                name: 'Rahul Kumar',
                pdfUrl: 'https://your-domain.com/invitations/rahul-invitation.pdf'
            }
        };
        
        // Old Memories Data
        const memoriesData = [
            { type: 'photo', url: 'https://cdn.jsdelivr.net/gh/CodeCr4cker/Web-Storage/Farewell-invitation-card/images/B%20L%20Academy(1).jpg' },
            { type: 'photo', url: 'https://cdn.jsdelivr.net/gh/CodeCr4cker/Web-Storage/Farewell-invitation-card/images/B%20L%20Academy(2).jpg' },
            { type: 'photo', url: 'https://cdn.jsdelivr.net/gh/CodeCr4cker/Web-Storage/Farewell-invitation-card/images/B%20L%20Academy(3).jpg' },
            { type: 'photo', url: 'https://cdn.jsdelivr.net/gh/CodeCr4cker/Web-Storage/Farewell-invitation-card/images/B%20L%20Academy(4).jpg' },
            { type: 'photo', url: 'https://cdn.jsdelivr.net/gh/CodeCr4cker/Web-Storage/Farewell-invitation-card/images/B%20L%20Academy(5).jpg' },
            { type: 'photo', url: 'https://cdn.jsdelivr.net/gh/CodeCr4cker/Web-Storage/Farewell-invitation-card/images/B%20L%20Academy(6).jpg' },
            { type: 'photo', url: 'https://cdn.jsdelivr.net/gh/CodeCr4cker/Web-Storage/Farewell-invitation-card/images/B%20L%20Academy(7).jpg' },
            { type: 'photo', url: 'https://cdn.jsdelivr.net/gh/CodeCr4cker/Web-Storage/Farewell-invitation-card/images/B%20L%20Academy(8).jpg' },
            { type: 'photo', url: 'https://cdn.jsdelivr.net/gh/CodeCr4cker/Web-Storage/Farewell-invitation-card/images/B%20L%20Academy(9).jpg' },
            { type: 'photo', url: 'https://cdn.jsdelivr.net/gh/CodeCr4cker/Web-Storage/Farewell-invitation-card/images/B%20L%20Academy(10).jpg' },
            { type: 'photo', url: 'https://cdn.jsdelivr.net/gh/CodeCr4cker/Web-Storage/Farewell-invitation-card/images/B%20L%20Academy(11).jpg' },
            { type: 'photo', url: 'https://cdn.jsdelivr.net/gh/CodeCr4cker/Web-Storage/Farewell-invitation-card/images/B%20L%20Academy(12).jpg' },
            { type: 'photo', url: 'https://cdn.jsdelivr.net/gh/CodeCr4cker/Web-Storage/Farewell-invitation-card/images/B%20L%20Academy(13).jpg' },
            { type: 'photo', url: 'https://cdn.jsdelivr.net/gh/CodeCr4cker/Web-Storage/Farewell-invitation-card/images/B%20L%20Academy(14).jpg' },
            { type: 'photo', url: 'https://cdn.jsdelivr.net/gh/CodeCr4cker/Web-Storage/Farewell-invitation-card/images/B%20L%20Academy(15).jpg' },
            { type: 'photo', url: 'https://cdn.jsdelivr.net/gh/CodeCr4cker/Web-Storage/Farewell-invitation-card/images/B%20L%20Academy(16).jpg' },
            { type: 'photo', url: 'https://cdn.jsdelivr.net/gh/CodeCr4cker/Web-Storage/Farewell-invitation-card/images/B%20L%20Academy(17).jpg' },
            { type: 'photo', url: 'https://cdn.jsdelivr.net/gh/CodeCr4cker/Web-Storage/Farewell-invitation-card/images/B%20L%20Academy(18).jpg' },
            { type: 'photo', url: 'https://cdn.jsdelivr.net/gh/CodeCr4cker/Web-Storage/Farewell-invitation-card/images/B%20L%20Academy(19).jpg' },
            { type: 'photo', url: 'https://cdn.jsdelivr.net/gh/CodeCr4cker/Web-Storage/Farewell-invitation-card/images/B%20L%20Academy(20).jpg' },
            { type: 'photo', url: 'https://cdn.jsdelivr.net/gh/CodeCr4cker/Web-Storage/Farewell-invitation-card/images/B%20L%20Academy(21).jpg' },
            { type: 'photo', url: 'https://cdn.jsdelivr.net/gh/CodeCr4cker/Web-Storage/Farewell-invitation-card/images/B%20L%20Academy(23).jpg' },
            { type: 'photo', url: 'https://cdn.jsdelivr.net/gh/CodeCr4cker/Web-Storage/Farewell-invitation-card/images/B%20L%20Academy(24).jpg' },
            { type: 'photo', url: 'https://cdn.jsdelivr.net/gh/CodeCr4cker/Web-Storage/Farewell-invitation-card/images/B%20L%20Academy(22).jpg' }
        ];
        
        // Farewell Gallery Data (Photos from GitHub)
        const PHOTO_LINKS = [
            'https://cdn.jsdelivr.net/gh/CodeCr4cker/Web-Storage/Farewell-invitation-card/images/B%20L%20Academy(1).jpg',
            'https://cdn.jsdelivr.net/gh/CodeCr4cker/Web-Storage/Farewell-invitation-card/images/B%20L%20Academy(2).jpg',
            'https://cdn.jsdelivr.net/gh/CodeCr4cker/Web-Storage/Farewell-invitation-card/images/B%20L%20Academy(3).jpg',
            'https://cdn.jsdelivr.net/gh/CodeCr4cker/Web-Storage/Farewell-invitation-card/images/B%20L%20Academy(4).jpg',
            'https://cdn.jsdelivr.net/gh/CodeCr4cker/Web-Storage/Farewell-invitation-card/images/B%20L%20Academy(5).jpg',
            'https://cdn.jsdelivr.net/gh/CodeCr4cker/Web-Storage/Farewell-invitation-card/images/B%20L%20Academy(6).jpg',
            'https://cdn.jsdelivr.net/gh/CodeCr4cker/Web-Storage/Farewell-invitation-card/images/B%20L%20Academy(7).jpg',
            'https://cdn.jsdelivr.net/gh/CodeCr4cker/Web-Storage/Farewell-invitation-card/images/B%20L%20Academy(8).jpg',
            'https://cdn.jsdelivr.net/gh/CodeCr4cker/Web-Storage/Farewell-invitation-card/images/B%20L%20Academy(9).jpg',
            'https://cdn.jsdelivr.net/gh/CodeCr4cker/Web-Storage/Farewell-invitation-card/images/B%20L%20Academy(10).jpg',
            'https://cdn.jsdelivr.net/gh/CodeCr4cker/Web-Storage/Farewell-invitation-card/images/B%20L%20Academy(11).jpg',
            'https://cdn.jsdelivr.net/gh/CodeCr4cker/Web-Storage/Farewell-invitation-card/images/B%20L%20Academy(12).jpg',
            'https://cdn.jsdelivr.net/gh/CodeCr4cker/Web-Storage/Farewell-invitation-card/images/B%20L%20Academy(13).jpg',
            'https://cdn.jsdelivr.net/gh/CodeCr4cker/Web-Storage/Farewell-invitation-card/images/B%20L%20Academy(14).jpg',
            'https://cdn.jsdelivr.net/gh/CodeCr4cker/Web-Storage/Farewell-invitation-card/images/B%20L%20Academy(15).jpg',
            'https://cdn.jsdelivr.net/gh/CodeCr4cker/Web-Storage/Farewell-invitation-card/images/B%20L%20Academy(16).jpg',
            'https://cdn.jsdelivr.net/gh/CodeCr4cker/Web-Storage/Farewell-invitation-card/images/B%20L%20Academy(17).jpg',
            'https://cdn.jsdelivr.net/gh/CodeCr4cker/Web-Storage/Farewell-invitation-card/images/B%20L%20Academy(18).jpg',
            'https://cdn.jsdelivr.net/gh/CodeCr4cker/Web-Storage/Farewell-invitation-card/images/B%20L%20Academy(19).jpg',
            'https://cdn.jsdelivr.net/gh/CodeCr4cker/Web-Storage/Farewell-invitation-card/images/B%20L%20Academy(20).jpg',
            'https://cdn.jsdelivr.net/gh/CodeCr4cker/Web-Storage/Farewell-invitation-card/images/B%20L%20Academy(21).jpg',
            'https://cdn.jsdelivr.net/gh/CodeCr4cker/Web-Storage/Farewell-invitation-card/images/B%20L%20Academy(22).jpg'
        ];
        
        const VIDEO_LINKS = [
            'https://www.w3schools.com/html/mov_bbb.mp4'
        ];
        
        // ========== END OF CONFIGURATION ==========
        
        // Global Variables
        let galleryUnlocked = false;
        let memoriesOpened = false;
        let currentTab = 'memories';
        let currentLightboxIndex = 0;
        let currentGalleryData = [];
        let mainAudio, galleryAudio;
        let isMainAudioPlaying = false;
        let isGalleryAudioPlaying = false;

        // Video Book Variables
        let currentPage = 0;
        let allVideos = [];
        let totalPages = 0;
        const book = document.querySelector('.book');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');

        // Initialize on page load
        window.addEventListener('load', () => {
            mainAudio = document.getElementById('mainAudio');
            galleryAudio = document.getElementById('galleryAudio');
            
            setTimeout(() => {
                document.getElementById('loader').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('loader').style.display = 'none';
                    document.getElementById('curtain').classList.add('visible');
                }, 500);
            }, 2000);
        });

        // Curtain Click Handler
        document.getElementById('curtain').addEventListener('click', function() {
            this.classList.add('open');
            
            mainAudio.play().then(() => {
                isMainAudioPlaying = true;
            }).catch(e => console.log('Audio play failed:', e));
            
            setTimeout(() => {
                this.style.display = 'none';
                document.getElementById('mainContent').classList.add('visible');
                document.getElementById('navBar').classList.add('visible');
                
                setTimeout(() => {
                    document.getElementById('home').classList.add('visible');
                }, 100);
                
                observeSection();
                startCountdown();
                createParticles();
                loadMemoriesGallery();
                initVideoBook();
                snow();
            }, 2000);
        });

        // Confetti Effect
        function snow() {
            const duration = 15 * 1000;
            const animationEnd = Date.now() + duration;
            function frame() {
                confetti({
                    particleCount: 1,
                    startVelocity: 0,
                    ticks: 200,
                    origin: { x: Math.random(), y: -0.1 },
                    colors: ['#ffd700', '#ff6b6b', '#4ecdc4'],
                    shapes: ['circle'],
                    gravity: 0.5,
                    scalar: 0.8,
                    drift: 0
                });
                if (Date.now() < animationEnd) requestAnimationFrame(frame);
            }
            frame();
        }

        // Create Particles
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 6 + 's';
                particle.style.animationDuration = Math.random() * 4 + 4 + 's';
                const colors = ['rgba(255, 215, 0, 0.6)', 'rgba(255, 107, 107, 0.6)', 'rgba(78, 205, 196, 0.6)'];
                particle.style.background = colors[Math.floor(Math.random() * colors.length)];
                particlesContainer.appendChild(particle);
            }
        }

        // Observe Gallery Section
        function observeSection() {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                    }
                });
            }, { threshold: 0.1 });
            
            observer.observe(document.getElementById('gallery'));
        }

        // Countdown Timer
        function startCountdown() {
            const countDownDate = new Date('Dec 14, 2025 11:30:00').getTime();
            
            const timer = setInterval(() => {
                const now = new Date().getTime();
                const distance = countDownDate - now;
                
                if (distance < 0) {
                    clearInterval(timer);
                    displayCountdownFinished();
                    return;
                }
                
                const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);
                
                document.getElementById('countdown').innerHTML = `
                    <div class="countdown-item">
                        <span class="countdown-number">${days.toString().padStart(2, '0')}</span>
                        <span class="countdown-label">Days</span>
                    </div>
                    <div class="countdown-item">
                        <span class="countdown-number">${hours.toString().padStart(2, '0')}</span>
                        <span class="countdown-label">Hours</span>
                    </div>
                    <div class="countdown-item">
                        <span class="countdown-number">${minutes.toString().padStart(2, '0')}</span>
                        <span class="countdown-label">Minutes</span>
                    </div>
                    <div class="countdown-item">
                        <span class="countdown-number">${seconds.toString().padStart(2, '0')}</span>
                        <span class="countdown-label">Seconds</span>
                    </div>
                `;
            }, 1000);
        }

        function displayCountdownFinished() {
            const container = document.getElementById('countdownContainer');
            container.innerHTML = `
                <div style="background: rgba(139, 92, 246, 0.15); border: 2px solid var(--accent-gold); border-radius: 20px; padding: 2rem; margin: 3rem 0;">
                    <h2 style="font-family: 'Playfair Display', serif; font-size: 2.5rem; color: var(--accent-gold); margin-bottom: 1rem;">
                         The Big Day is Here! 
                    </h2>
                    <p style="font-size: 1.2rem; color: var(--text-light); margin: 0.5rem 0;">
                        Hope you had an amazing time at the farewell!
                    </p>
                    <p style="margin-top: 1rem;">
                        Thank you for being part of this incredible journey. May all your dreams come true! 
                    </p>
                </div>
            `;
        }

        // ========== VIDEO BOOK FUNCTIONS ==========
        
        function initVideoBook() {
            if (!book) return;
            book.style.setProperty("--c", 0);
            allVideos = Array.from(book.querySelectorAll("video"));
            totalPages = book.querySelectorAll(".page").length - 1; // treat last special as "end"
            
            book.querySelectorAll(".page").forEach((page, idx) => {
                page.style.setProperty("--i", idx);
                
                page.addEventListener("click", (evt) => {
                    if (evt.target.closest('video') || evt.target.closest('.play-overlay')) {
                        return;
                    }
                    
                    const curr = evt.target.closest(".back") ? idx : idx + 1;
                    goToPage(curr);
                });
            });

            // Setup play overlays - Open video in modal
            document.querySelectorAll('.play-overlay').forEach(overlay => {
                overlay.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const video = overlay.previousElementSibling;
                    if (video && video.tagName === 'VIDEO') {
                        const srcEl = video.querySelector('source');
                        const src = srcEl ? srcEl.src : video.src;
                        openVideoModal(src);
                    }
                });
            });

            // Prevent context menu on videos
            document.querySelectorAll('video').forEach(video => {
                video.addEventListener("contextmenu", e => e.preventDefault());
            });

            // Navigation buttons
            if (prevBtn) {
                prevBtn.addEventListener('click', () => {
                    if (currentPage > 0) goToPage(currentPage - 1);
                });
            }
            if (nextBtn) {
                nextBtn.addEventListener('click', () => {
                    if (currentPage < totalPages + 1) goToPage(currentPage + 1);
                });
            }

            // Show nav arrows when book section is in view
            observeBookSection();
        }

        function observeBookSection() {
            const bookSection = document.querySelector('.book-container');
            const navArrows = document.querySelector('.nav-arrows');
            
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        navArrows.classList.add('visible');
                    } else {
                        navArrows.classList.remove('visible');
                    }
                });
            }, { threshold: 0.3 });
            
            if (bookSection) observer.observe(bookSection);
        }

        function openVideoModal(videoSrc) {
            const videoModal = document.getElementById('videoModal');
            const modalVideo = document.getElementById('modalVideo');
            
            // Pause all audio
            if (isMainAudioPlaying) {
                mainAudio.pause();
                isMainAudioPlaying = false;
            }
            if (isGalleryAudioPlaying) {
                galleryAudio.pause();
                isGalleryAudioPlaying = false;
            }
            
            // Set video source and play
            modalVideo.src = videoSrc;
            videoModal.classList.add('active');
            modalVideo.play();
            
            // Resume audio when video ends or is paused
            modalVideo.addEventListener('ended', handleVideoModalEnd);
            modalVideo.addEventListener('pause', handleVideoModalPause);
        }

        function closeVideoModal() {
            const videoModal = document.getElementById('videoModal');
            const modalVideo = document.getElementById('modalVideo');
            
            modalVideo.pause();
            modalVideo.currentTime = 0;
            modalVideo.src = '';
            videoModal.classList.remove('active');
            
            // Remove event listeners
            modalVideo.removeEventListener('ended', handleVideoModalEnd);
            modalVideo.removeEventListener('pause', handleVideoModalPause);
            
            // Resume audio
            resumeAudioAfterVideoModal();
        }

        function handleVideoModalEnd() {
            setTimeout(() => {
                closeVideoModal();
            }, 500);
        }

        function handleVideoModalPause() {
            const modalVideo = document.getElementById('modalVideo');
            // Only resume audio if video has ended or is at the end
            if (modalVideo.currentTime === modalVideo.duration || modalVideo.ended) {
                resumeAudioAfterVideoModal();
            }
        }

        function resumeAudioAfterVideoModal() {
            // Resume the appropriate audio based on current tab
            if (currentTab === 'memories' || !galleryUnlocked) {
                mainAudio.play().then(() => {
                    isMainAudioPlaying = true;
                }).catch(e => console.log('Resume main audio failed:', e));
            } else {
                galleryAudio.play().then(() => {
                    isGalleryAudioPlaying = true;
                }).catch(e => console.log('Resume gallery audio failed:', e));
            }
        }

        function goToPage(pageNum) {
            if (pageNum < 0) return;
            
            currentPage = pageNum;
            book.style.setProperty("--c", currentPage);
            
            if (prevBtn) prevBtn.disabled = currentPage === 0;
            if (nextBtn) nextBtn.disabled = currentPage === totalPages + 1;
            
            handleVideoPlayback(currentPage);
            
            if (currentPage === totalPages + 1) {
                setTimeout(() => {
                    book.classList.add('closed');
                    setTimeout(() => {
                        currentPage = 0;
                        book.style.setProperty("--c", 0);
                        book.classList.remove('closed');
                        if (prevBtn) prevBtn.disabled = true;
                        if (nextBtn) nextBtn.disabled = false;
                        handleVideoPlayback(0);
                    }, 2000);
                }, 1000);
            }
        }

        function handleVideoPlayback(pageIndex) {
            // Reset all play overlays when changing pages
            allVideos.forEach((video, idx) => {
                const overlay = video.parentElement.querySelector('.play-overlay');
                if (overlay) {
                    overlay.classList.remove('hidden');
                }
            });
        }

        // Keyboard navigation for book
        document.addEventListener('keydown', (e) => {
            const lightbox = document.getElementById('lightbox');
            const galleryModal = document.getElementById('galleryModal');
            const invitationModal = document.getElementById('personalInvitationModal');
            const videoModal = document.getElementById('videoModal');
            
            // Video modal controls
            if (videoModal.classList.contains('active')) {
                if (e.key === 'Escape') closeVideoModal();
                return;
            }
            
            // Book navigation (only when no modals are open)
            if (!lightbox.classList.contains('active') && 
                !galleryModal.classList.contains('active') && 
                !invitationModal.classList.contains('active')) {
                if (e.key === 'ArrowRight') nextBtn && nextBtn.click();
                else if (e.key === 'ArrowLeft') prevBtn && prevBtn.click();
            }
            
            if (lightbox.classList.contains('active') && e.key === 'Escape') closeLightbox();
            if (galleryModal.classList.contains('active')) {
                if (e.key === 'Enter') verifyGalleryCode();
                if (e.key === 'Escape') closeGalleryModal();
            }
            if (invitationModal.classList.contains('active')) {
                if (e.key === 'Enter') generatePersonalInvitation();
                if (e.key === 'Escape') closePersonalInvitationModal();
            }
        });

        // ========== GALLERY FUNCTIONS ==========

        function loadMemoriesGallery() {
            const grid = document.getElementById('memoriesGrid');
            grid.innerHTML = '';
            memoriesData.forEach((item, index) => {
                const card = document.createElement('div');
                card.className = 'polaroid-card';
                card.onclick = () => openLightbox(index, memoriesData);
                card.innerHTML = `<img src="${item.url}" alt="Memory ${index + 1}" class="polaroid-img">`;
                grid.appendChild(card);
            });
        }

        function generateFarewellData() {
            const items = [];
            
            PHOTO_LINKS.forEach((url, index) => {
                items.push({
                    type: 'photo',
                    url: url,
                    title: `Memory ${index + 1}`,
                    desc: 'Special farewell moment'
                });
            });
            
            VIDEO_LINKS.forEach((url, index) => {
                items.push({
                    type: 'video',
                    url: url,
                    title: `Video ${index + 1}`,
                    desc: 'Farewell highlights'
                });
            });
            
            return items;
        }

        function openMemoriesGallery() {
            memoriesOpened = true;
            document.getElementById('memoriesLock').classList.add('hidden');
            document.getElementById('memoriesGrid').classList.add('visible');
            document.getElementById('closeGalleryBtn').classList.add('visible');
            document.getElementById('closeGalleryBtn').onclick = closeMemoriesGallery;
        }

        function closeMemoriesGallery() {
            memoriesOpened = false;
            document.getElementById('memoriesLock').classList.remove('hidden');
            document.getElementById('memoriesGrid').classList.remove('visible');
            document.getElementById('closeGalleryBtn').classList.remove('visible');
        }

        // Updated: accept event parameter to avoid "event is not defined"
        function switchGalleryTab(tab, evt) {
            currentTab = tab;
            
            // Manage active states for nav buttons
            document.querySelectorAll('.gallery-nav-btn').forEach(btn => btn.classList.remove('active'));
            if (evt && evt.currentTarget) {
                evt.currentTarget.classList.add('active');
            } else {
                // fallback: activate by data-tab
                const btn = document.querySelector(`.gallery-nav-btn[data-tab="${tab}"]`);
                if (btn) btn.classList.add('active');
            }
            
            document.querySelectorAll('.gallery-tab').forEach(tabEl => tabEl.classList.remove('active'));
            
            if (tab === 'memories') {
                document.getElementById('memoriesTab').classList.add('active');
                if (memoriesOpened) {
                    document.getElementById('closeGalleryBtn').classList.add('visible');
                    document.getElementById('closeGalleryBtn').onclick = closeMemoriesGallery;
                } else {
                    document.getElementById('closeGalleryBtn').classList.remove('visible');
                }
                
                if (galleryUnlocked && isGalleryAudioPlaying) {
                    switchAudioToMain();
                }
            } else {
                document.getElementById('farewellTab').classList.add('active');
                if (galleryUnlocked) {
                    document.getElementById('closeGalleryBtn').classList.add('visible');
                    document.getElementById('closeGalleryBtn').onclick = closeFarewellGallery;
                    
                    if (isMainAudioPlaying) {
                        switchAudioToGallery();
                    }
                } else {
                    document.getElementById('closeGalleryBtn').classList.remove('visible');
                }
            }
        }

        function openGalleryModal() {
            document.getElementById('galleryModal').classList.add('active');
            document.getElementById('galleryCode').focus();
        }

        function closeGalleryModal() {
            document.getElementById('galleryModal').classList.remove('active');
            document.getElementById('galleryCode').value = '';
            const err = document.getElementById('galleryError');
            if (err) err.style.display = 'none';
        }

        function verifyGalleryCode() {
            const codeEl = document.getElementById('galleryCode');
            if (!codeEl) return;
            const code = codeEl.value.trim().toUpperCase();
            const errorMsg = document.getElementById('galleryError');
            
            if (code === GALLERY_CODE) {
                galleryUnlocked = true;
                closeGalleryModal();
                unlockGallery();
                showSuccessNotification('Gallery Unlocked Successfully!');
            } else {
                if (errorMsg) errorMsg.style.display = 'block';
                codeEl.value = '';
                setTimeout(() => {
                    if (errorMsg) errorMsg.style.display = 'none';
                }, 3000);
            }
        }

        function unlockGallery() {
            galleryUnlocked = true;
            document.getElementById('galleryLock').classList.add('hidden');
            const grid = document.getElementById('farewellGrid');
            grid.style.display = 'grid';
            document.getElementById('closeGalleryBtn').classList.add('visible');
            document.getElementById('closeGalleryBtn').onclick = closeFarewellGallery;
            
            if (isMainAudioPlaying) {
                switchAudioToGallery();
            }
            
            const farewellData = generateFarewellData();
            grid.innerHTML = '';
            
            farewellData.forEach((item, index) => {
                const card = document.createElement('div');
                card.className = `media-card ${item.type}`;
                card.onclick = () => openLightbox(index, farewellData);
                
                const mediaHtml = item.type === 'video' 
                    ? `<video src="${item.url}"></video><div class="play-icon"></div>`
                    : `<img src="${item.url}" alt="${item.title}">`;
                
                card.innerHTML = `
                    <div class="media-content">
                        ${mediaHtml}
                        <div class="media-overlay">
                            <div class="media-title">${item.title}</div>
                            <div class="media-desc">${item.desc}</div>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        function closeFarewellGallery() {
            galleryUnlocked = false;
            document.getElementById('galleryLock').classList.remove('hidden');
            const grid = document.getElementById('farewellGrid');
            grid.style.display = 'none';
            grid.innerHTML = '';
            
            currentTab = 'memories';
            document.querySelectorAll('.gallery-nav-btn').forEach((btn, index) => {
                if (index === 0) btn.classList.add('active');
                else btn.classList.remove('active');
            });
            
            document.querySelectorAll('.gallery-tab').forEach(tabEl => tabEl.classList.remove('active'));
            document.getElementById('memoriesTab').classList.add('active');
            
            if (memoriesOpened) {
                document.getElementById('closeGalleryBtn').classList.add('visible');
                document.getElementById('closeGalleryBtn').onclick = closeMemoriesGallery;
            } else {
                document.getElementById('closeGalleryBtn').classList.remove('visible');
            }
            
            if (isGalleryAudioPlaying) {
                switchAudioToMain();
            }
            
            showSuccessNotification('Farewell Gallery Locked.');
        }

        function switchAudioToGallery() {
            if (!mainAudio || !galleryAudio) return;
            let mainVolume = mainAudio.volume;
            const fadeOutMain = setInterval(() => {
                if (mainVolume > 0.05) {
                    mainVolume -= 0.05;
                    mainAudio.volume = mainVolume;
                } else {
                    mainAudio.pause();
                    mainAudio.volume = 1;
                    isMainAudioPlaying = false;
                    clearInterval(fadeOutMain);
                    galleryAudio.play().then(() => {
                        isGalleryAudioPlaying = true;
                    }).catch(e => console.log('Gallery audio play failed:', e));
                }
            }, 50);
        }

        function switchAudioToMain() {
            if (!mainAudio || !galleryAudio) return;
            let galleryVolume = galleryAudio.volume;
            const fadeOutGallery = setInterval(() => {
                if (galleryVolume > 0.05) {
                    galleryVolume -= 0.05;
                    galleryAudio.volume = galleryVolume;
                } else {
                    galleryAudio.pause();
                    galleryAudio.volume = 1;
                    isGalleryAudioPlaying = false;
                    clearInterval(fadeOutGallery);
                    mainAudio.play().then(() => {
                        isMainAudioPlaying = true;
                    }).catch(e => console.log('Main audio play failed:', e));
                }
            }, 50);
        }

        function openLightbox(index, data) {
            currentLightboxIndex = index;
            currentGalleryData = data;
            const lightbox = document.getElementById('lightbox');
            const lightboxMedia = document.getElementById('lightboxMedia');
            const item = data[index];
            
            if (item.type === 'video') {
                if (isMainAudioPlaying) mainAudio.pause();
                if (isGalleryAudioPlaying) galleryAudio.pause();
                lightboxMedia.innerHTML = `<video src="${item.url}" controls autoplay style="max-width: 90vw; max-height: 80vh;"></video>`;
                const videoElement = lightboxMedia.querySelector('video');
                videoElement.addEventListener('ended', resumeAudioAfterVideo);
                videoElement.addEventListener('pause', resumeAudioAfterVideo);
            } else {
                lightboxMedia.innerHTML = `<img src="${item.url}" alt="${item.title || 'Memory'}">`;
            }
            
            lightbox.classList.add('active');
        }

        function closeLightbox() {
            const lightbox = document.getElementById('lightbox');
            lightbox.classList.remove('active');
            const video = lightbox.querySelector('video');
            
            if (video) {
                video.pause();
                video.currentTime = 0;
                video.removeEventListener('ended', resumeAudioAfterVideo);
                video.removeEventListener('pause', resumeAudioAfterVideo);
                resumeAudioAfterVideo();
            }
        }

        function resumeAudioAfterVideo() {
            if (currentTab === 'memories' || !galleryUnlocked) {
                if (!isMainAudioPlaying) {
                    mainAudio.play().then(() => {
                        isMainAudioPlaying = true;
                    }).catch(e => console.log('Resume main audio failed:', e));
                }
            } else {
                if (!isGalleryAudioPlaying) {
                    galleryAudio.play().then(() => {
                        isGalleryAudioPlaying = true;
                    }).catch(e => console.log('Resume gallery audio failed:', e));
                }
            }
        }

        function openPersonalInvitationModal() {
            document.getElementById('personalInvitationModal').classList.add('active');
            document.getElementById('username').focus();
        }

        function closePersonalInvitationModal() {
            document.getElementById('personalInvitationModal').classList.remove('active');
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            const err = document.getElementById('invitationError');
            if (err) err.style.display = 'none';
        }

        function generatePersonalInvitation() {
            const username = document.getElementById('username').value.trim().toLowerCase();
            const password = document.getElementById('password').value.trim();
            const errorMsg = document.getElementById('invitationError');
            
            const user = userDatabase[username];
            
            if (!user || user.password !== password) {
                if (errorMsg) errorMsg.style.display = 'block';
                setTimeout(() => {
                    if (errorMsg) errorMsg.style.display = 'none';
                }, 3000);
                return;
            }
            
            downloadPDF(user.pdfUrl, `Farewell_Invitation_${user.name.replace(/\s+/g, '_')}.pdf`);
            closePersonalInvitationModal();
            showSuccessNotification(`Personal Invitation for ${user.name} Downloaded!`);
        }

        function downloadPDF(pdfUrl, filename) {
            const link = document.createElement('a');
            link.href = pdfUrl;
            link.download = filename;
            link.target = '_blank';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function showSuccessNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'success-notification';
            notification.innerHTML = `<i class="fas fa-check-circle"></i> ${message}`;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Gallery Code Input Formatter
        const galleryCodeEl = document.getElementById('galleryCode');
        if (galleryCodeEl) {
            galleryCodeEl.addEventListener('input', function(e) {
                this.value = this.value.toUpperCase().replace(/[^A-Z0-9]/g, '');
            });
        }

        // Smooth Scroll for Navigation Links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth' });
                }
            });
        });

        // Close modals when clicking outside
        document.getElementById('lightbox').addEventListener('click', function(e) {
            if (e.target === this) closeLightbox();
        });

        document.getElementById('galleryModal').addEventListener('click', function(e) {
            if (e.target === this) closeGalleryModal();
        });

        document.getElementById('personalInvitationModal').addEventListener('click', function(e) {
            if (e.target === this) closePersonalInvitationModal();
        });

        document.getElementById('videoModal').addEventListener('click', function(e) {
            if (e.target === this) closeVideoModal();
        });

        // Audio pause/resume on tab visibility change
        document.addEventListener('visibilitychange', function () {
            if (document.hidden) {
                if (isMainAudioPlaying) mainAudio.pause();
                if (isGalleryAudioPlaying) galleryAudio.pause();
            } else {
                if (isMainAudioPlaying && !galleryUnlocked) mainAudio.play().catch(console.log);
                if (isGalleryAudioPlaying && galleryUnlocked) galleryAudio.play().catch(console.log);
            }
        });

        // Console Easter Egg
        console.log('%cFarewell 2025 ', 'color: #ffd700; font-size: 24px; font-weight: bold;');
        console.log('%cAccess Code: 12BL25', 'color: #4ecdc4; font-size: 16px;');
        console.log('%cMade with  by Divyanshu Pandey', 'color: #8b5cf6; font-size: 14px;');
    </script>
</body>
</html>
